<section class="report-section">
  <h2>Executive Summary</h2>
  <div class="kpi-grid">
    <article class="section-card">
      <h3>Top Lines</h3>
      <ul>
        {% if benchmarking.bestYield %}
        {% set best = benchmarking.bestYield %}
        {% if best.windowYield is not none %}
        {% set best_label = 'Window Yield' %}
        {% set best_value = best.windowYield %}
        {% elif best.truePartYield is not none %}
        {% set best_label = 'True Part Yield' %}
        {% set best_value = best.truePartYield %}
        {% elif best.rawPartYield is not none %}
        {% set best_label = 'Raw Part Yield' %}
        {% set best_value = best.rawPartYield %}
        {% else %}
        {% set best_label = 'Yield' %}
        {% set best_value = 0 %}
        {% endif %}
        <li><strong>Best {{ best_label }}:</strong> {{ best.line }} ({{ best_value|round(2) }}%)</li>
        {% endif %}
        {% if benchmarking.lowestFalseCalls %}
        <li><strong>Lowest False Calls:</strong> {{ benchmarking.lowestFalseCalls.line }} ({{ benchmarking.lowestFalseCalls.falseCallsPerBoard|round(2) }})</li>
        {% endif %}
        {% if benchmarking.mostConsistent %}
        <li><strong>Most Consistent:</strong> {{ benchmarking.mostConsistent.line }} (σ {{ benchmarking.mostConsistent.stddev|round(2) }})</li>
        {% endif %}
      </ul>
    </article>
    <article class="section-card">
      <h3>Company Averages</h3>
      <ul>
        <li>Window Yield: {{ (companyAverages.windowYield if companyAverages.windowYield is not none else 0)|round(2) }}%</li>
        <li>True Part Yield: {{ (companyAverages.truePartYield if companyAverages.truePartYield is not none else 0)|round(2) }}%</li>
        <li>Raw Part Yield: {{ (companyAverages.rawPartYield if companyAverages.rawPartYield is not none else 0)|round(2) }}%</li>
        <li>False Calls / Board: {{ companyAverages.falseCallsPerBoard|round(2) }}</li>
        <li>False Call PPM: {{ (companyAverages.falseCallPpm if companyAverages.falseCallPpm is not none else 0)|round(2) }}</li>
        <li>False Call DPM: {{ (companyAverages.falseCallDpm if companyAverages.falseCallDpm is not none else 0)|round(2) }}</li>
        <li>Defect DPM: {{ (companyAverages.defectDpm if companyAverages.defectDpm is not none else 0)|round(2) }}</li>
        <li>NG Parts: {{ companyAverages.ngParts|round(0) }}</li>
        <li>NG Windows: {{ companyAverages.ngWindows|round(0) }}</li>
        <li>Windows / Board: {{ (companyAverages.windowsPerBoard if companyAverages.windowsPerBoard is not none else 0)|round(2) }}</li>
        <li>Defects / Board: {{ (companyAverages.defectsPerBoard if companyAverages.defectsPerBoard is not none else 0)|round(2) }}</li>
      </ul>
    </article>
    <article class="section-card">
      <h3>Key Insights</h3>
      <ul>
        {% set drift = (trendInsights.lineDrift or [])[:3] %}
        {% if drift %}
          {% for item in drift %}
          <li>{{ item.line }} window yield drifted {{ item.change|round(2) }} pts ({{ item.start|round(2) }}% → {{ item.end|round(2) }}%).</li>
          {% endfor %}
        {% else %}
          <li>No significant yield drift detected across lines.</li>
        {% endif %}
      </ul>
    </article>
  </div>
</section>
