<section class="report-section">
  <h2>Executive Summary</h2>
  <div class="kpi-grid">
    <article class="section-card">
      <h3>Top Lines</h3>
      <ul>
        {% if benchmarking.bestYield %}
        {% set best_yield = benchmarking.bestYield.windowYield if benchmarking.bestYield.windowYield is not none else benchmarking.bestYield.partYield if benchmarking.bestYield.partYield is not none else benchmarking.bestYield.yield %}
        <li><strong>Best Window Yield:</strong> {{ benchmarking.bestYield.line }} ({{ best_yield|round(2) }}%)</li>
        {% endif %}
        {% if benchmarking.lowestFalseCalls %}
        <li><strong>Lowest False Calls:</strong> {{ benchmarking.lowestFalseCalls.line }} ({{ benchmarking.lowestFalseCalls.falseCallsPerBoard|round(2) }})</li>
        {% endif %}
        {% if benchmarking.mostConsistent %}
        <li><strong>Most Consistent:</strong> {{ benchmarking.mostConsistent.line }} (σ {{ benchmarking.mostConsistent.stddev|round(2) }})</li>
        {% endif %}
      </ul>
    </article>
    <article class="section-card">
      <h3>Company Averages</h3>
      <ul>
        <li>Window Yield: {{ (companyAverages.windowYield if companyAverages.windowYield is not none else companyAverages.yield)|round(2) }}%</li>
        <li>False Calls / Board: {{ companyAverages.falseCallsPerBoard|round(2) }}</li>
        <li>False Call PPM: {{ (companyAverages.falseCallPpm if companyAverages.falseCallPpm is not none else 0)|round(2) }}</li>
        <li>False Call DPM: {{ (companyAverages.falseCallDpm if companyAverages.falseCallDpm is not none else 0)|round(2) }}</li>
        <li>Defect DPM: {{ (companyAverages.defectDpm if companyAverages.defectDpm is not none else 0)|round(2) }}</li>
      </ul>
    </article>
    <article class="section-card">
      <h3>Key Insights</h3>
      <ul>
        {% set drift = (trendInsights.lineDrift or [])[:3] %}
        {% if drift %}
          {% for item in drift %}
          <li>{{ item.line }} window yield drifted {{ item.change|round(2) }} pts ({{ item.start|round(2) }}% → {{ item.end|round(2) }}%).</li>
          {% endfor %}
        {% else %}
          <li>No significant yield drift detected across lines.</li>
        {% endif %}
      </ul>
    </article>
  </div>
</section>
