<section class="report-section">
  <h2>Line-Level Performance</h2>
  <div class="chart-grid chart-grid--single">
    <div class="chart-block chart-block--wide">
      <h3>Yield Performance</h3>
      <img src="{{ lineYieldOverlayImg }}" alt="Yield performance over time" />
      <div class="chart-summary">
        <p>Composite window, true-part, and raw-part yields for the selected period.</p>
      </div>
    </div>
  </div>
  {% set summary = linePeriodSummary or {} %}
  {% set header = summary.get('overall') %}
  {% if header %}
  <div class="kpi-row metrics-kpi-row">
    <div class="kpi-metric">
      <span>Window Yield</span>
      <strong>
        {% if header.window_yield_pct is not none %}
          {{ '%.2f'|format(header.window_yield_pct) }}%
        {% else %}
          --
        {% endif %}
      </strong>
    </div>
    <div class="kpi-metric">
      <span>True Part Yield</span>
      <strong>
        {% if header.true_part_yield_pct is not none %}
          {{ '%.2f'|format(header.true_part_yield_pct) }}%
        {% else %}
          --
        {% endif %}
      </strong>
    </div>
    <div class="kpi-metric">
      <span>False Calls / Board</span>
      <strong>{{ '%.2f'|format(header.fc_per_board or 0) }}</strong>
    </div>
    <div class="kpi-metric">
      <span>Defects / Board</span>
      <strong>
        {% if header.defects_per_board is not none %}
          {{ '%.2f'|format(header.defects_per_board) }}
        {% else %}
          --
        {% endif %}
      </strong>
    </div>
  </div>
  {% endif %}
  <table class="data-table">
    <thead>
      <tr>
        <th>Line</th>
        <th>Total Boards</th>
        <th>Total Parts</th>
        <th>NG Parts</th>
        <th>False Calls</th>
      </tr>
    </thead>
    <tbody>
      {% for metric in lineMetrics %}
      <tr>
        <td>{{ metric.line }}</td>
        <td>{{ metric.totalBoards|round(0) }}</td>
        <td>{{ metric.totalParts|round(0) }}</td>
        <td>{{ metric.ngParts|round(0) }}</td>
        <td>{{ metric.falseCalls|round(0) }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</section>
