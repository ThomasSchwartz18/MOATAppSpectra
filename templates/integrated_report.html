{% extends 'base.html' %}

{% block content %}
<h2>AOI Integrated Report</h2>

<div class="section-card">
  <div class="field-row">
    <div class="field">
      <label for="start-date">Start Date</label>
      <input type="date" id="start-date" />
    </div>
    <div class="field">
      <label for="end-date">End Date</label>
      <input type="date" id="end-date" />
    </div>
    <button type="button" id="run-report">Run</button>
  </div>
</div>

  <details id="charts" class="section-card">
    <summary>Preview Charts</summary>
    <div>
      <div class="chart-block">
        <canvas id="yieldTrendChart"></canvas>
        <div class="chart-summary">
          <p id="yieldTrendDesc"></p>
          <table id="yieldTrendTable" class="data-table"><tbody></tbody></table>
        </div>
      </div>
      <div class="chart-block">
        <canvas id="operatorRejectChart"></canvas>
        <div class="chart-summary">
          <p id="operatorRejectDesc"></p>
          <table id="operatorRejectTable" class="data-table">
            <thead>
              <tr>
                <th>Operator</th>
                <th>Inspected</th>
                <th>Rejected</th>
                <th>Reject %</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
      <div class="chart-block">
        <canvas id="modelFalseCallsChart"></canvas>
        <div class="chart-summary">
          <p id="modelFalseCallsDesc"></p>
          <table id="problem-assemblies" class="data-table"><tbody></tbody></table>
        </div>
      </div>
      <div class="chart-block">
        <canvas id="fcVsNgRateChart"></canvas>
        <div class="chart-summary">
          <p id="fcVsNgDesc"></p>
          <table id="fcVsNgRateTable" class="data-table"><tbody></tbody></table>
        </div>
      </div>
      <div class="chart-block">
        <canvas id="fcNgRatioChart"></canvas>
        <div class="chart-summary">
          <p id="fcNgRatioDesc"></p>
          <table id="fcNgRatioTable" class="data-table">
            <thead>
              <tr>
                <th>Model</th>
                <th>FalseCall Parts</th>
                <th>NG Parts</th>
                <th>FC/NG Ratio</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>
  </details>

<div class="field-row" id="download-controls">
  <div class="field">
    <label for="file-format">Format</label>
    <select id="file-format">
      <option value="pdf">pdf</option>
      <option value="html">html</option>
    </select>
  </div>
  <div class="field">
    <label for="include-cover">Cover Page</label>
    <input type="checkbox" id="include-cover" checked />
  </div>
  <button id="download-report">Download</button>
  <span class="spinner" id="download-spinner" hidden></span>
  <button id="email-report">Email Report</button>
  <p class="pdf-host-warning">PDF generation requires a Linux or Windows host. macOS is not supported.</p>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script type="module" src="{{ url_for('static', filename='js/integrated_report.js') }}"></script>
{% endblock %}
