<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Integrated Report</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/report.css') }}">
</head>
<body>
    <header>
        <img src="{{ url_for('static', filename='images/company-logo.png') }}" alt="Company logo">
        <h1>Integrated Report</h1>
    </header>
    <main>
        <div class="section-card">
            <div class="chart-block">
                <img src="{{ yieldTrendImg }}" alt="Yield Trend">
                <div class="chart-summary">
                    <p>Date range: {{ start }} - {{ end }}
Average yield: {{ yieldSummary.avg|round(1) }}%
Lowest yield date: {{ yieldSummary.worstDay.date or 'N/A' }} ({{ yieldSummary.worstDay.yield|round(1) }}%)
Worst assembly: {{ yieldSummary.worstAssembly.assembly or 'N/A' }} ({{ yieldSummary.worstAssembly.yield|round(1) }}%)</p>
                    <table class="data-table">
                        <tbody>
                        {% for d, y in yield_pairs %}
                            <tr><td>{{ d }}</td><td>{{ '%.1f'|format(y) }}</td></tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="chart-block">
                <img src="{{ operatorRejectImg }}" alt="Operator Reject">
                <div class="chart-summary">
                    <p>Date range: {{ start }} - {{ end }}
Total boards: {{ operatorSummary.totalBoards }}
Average reject rate: {{ operatorSummary.avgRate|round(2) }}%
Min reject rate: {{ operatorSummary.min.name or 'N/A' }} ({{ operatorSummary.min.rate|round(2) }}%)
Max reject rate: {{ operatorSummary.max.name or 'N/A' }} ({{ operatorSummary.max.rate|round(2) }}%)</p>
                    <table class="data-table">
                        <thead>
                            <tr><th>Operator</th><th>Inspected</th><th>Rejected</th><th>Reject %</th></tr>
                        </thead>
                        <tbody>
                        {% for op in operators %}
                            <tr>
                                <td>{{ op.name }}</td>
                                <td>{{ op.inspected }}</td>
                                <td>{{ op.rejected }}</td>
                                <td>{{ '%.2f'|format(op.rate) }}%</td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="chart-block">
                <img src="{{ modelFalseCallsImg }}" alt="False Calls by Model">
                <div class="chart-summary">
                    <p>Date range: {{ start }} - {{ end }}
Average false calls/board: {{ modelSummary.avgFalseCalls|round(2) }}
Line chart shows mean and ±3σ control limits; models outside may need review.
Problem assemblies (>20 false calls/board): {{ modelSummary.over20|join(', ') if modelSummary.over20 else 'None' }}</p>
                    <table id="problem-assemblies" class="data-table">
                        <thead><tr><th>Model</th><th>False Calls</th></tr></thead>
                        <tbody>
                        {% for m in problemAssemblies %}
                            <tr><td>{{ m.name }}</td><td>{{ m.falseCalls }}</td></tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="chart-block">
                <img src="{{ fcVsNgRateImg }}" alt="FC vs NG Rate">
                <div class="chart-summary">
                    <p>Date range: {{ start }} - {{ end }}
Correlation (FC vs NG): {{ fcVsNgSummary.correlation|round(2) }}
False call rate has {{ fcVsNgSummary.fcTrend }} over period</p>
                    <table id="fcVsNgRateTable" class="data-table">
                        <thead><tr><th>Date</th><th>NG PPM</th><th>FalseCall PPM</th></tr></thead>
                        <tbody>
                        {% for d, ng, fc in fc_vs_ng_pairs %}
                            <tr><td>{{ d }}</td><td>{{ '%.1f'|format(ng) }}</td><td>{{ '%.1f'|format(fc) }}</td></tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="chart-block">
                <img src="{{ fcNgRatioImg }}" alt="FC/NG Ratio">
                <div class="chart-summary">
                    <p>Date range: {{ start }} - {{ end }}
Top ratios: {% if fcNgRatioSummary.top %}{% for t in fcNgRatioSummary.top %}{{ t.name }} ({{ '%.2f'|format(t.ratio) }}){% if not loop.last %}, {% endif %}{% endfor %}{% else %}None{% endif %}</p>
                    <table id="fcNgRatioTable" class="data-table">
                        <thead><tr><th>Model</th><th>FalseCall Parts</th><th>NG Parts</th><th>FC/NG Ratio</th></tr></thead>
                        <tbody>
                        {% for m, fc, ng, r in fc_ng_ratio_pairs %}
                            <tr><td>{{ m }}</td><td>{{ '%.1f'|format(fc) }}</td><td>{{ '%.1f'|format(ng) }}</td><td>{{ '%.2f'|format(r) }}</td></tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>
</body>
</html>
