{% extends 'base.html' %}

{% block content %}
<h1>Previews</h1>
<h3><i>(click to see further insight)</i></h3>
<section class="dashboard-grid">
  <a class="dashboard-link" href="{{ url_for('main.ppm_analysis') }}">
    <div class="dashboard-card">
      <h2>PPM Analysis</h2>
      <canvas id="ppmAnalysisPreview"></canvas>
    </div>
  </a>
  <a class="dashboard-link" href="{{ url_for('main.aoi_grades_page') }}">
    <div class="dashboard-card">
      <h2>AOI &amp; FI Analysis</h2>
      <canvas id="aoiFiAnalysisPreview"></canvas>
    </div>
  </a>
  <a class="dashboard-link" href="{{ url_for('main.aoi_daily_report_page') }}">
    <div class="dashboard-card">
      <h2>Daily Reports</h2>
      <canvas id="dailyReportsPreview"></canvas>
    </div>
  </a>
  <a class="dashboard-link" href="{{ url_for('main.assembly_forecast') }}">
    <div class="dashboard-card">
      <h2>Assembly Forecast</h2>
      <canvas id="assemblyForecastPreview"></canvas>
    </div>
  </a>
  <a
    class="dashboard-link"
    href="{{ url_for('main.analysis_tracker_logs', tab='bug-reports') }}"
  >
    <div class="dashboard-card">
      <h2>Bug Reports</h2>
      <canvas id="bugReportsPreview"></canvas>
      <p id="bugReportsInfo" class="dashboard-card__info">Loading bug report summary…</p>
    </div>
  </a>
  <a
    class="dashboard-link"
    href="{{ url_for('main.analysis_tracker_logs', tab='analytics') }}"
  >
    <div class="dashboard-card">
      <h2>Tracker Analytics</h2>
      <canvas id="trackerAnalyticsPreview"></canvas>
      <p id="trackerAnalyticsInfo" class="dashboard-card__info">Loading tracker analytics…</p>
    </div>
  </a>
</section>
{% if user_role == 'ADMIN' and code_errors %}
<section class="admin-diagnostics">
  <h2>System Diagnostics</h2>
  <p class="admin-diagnostics__lead">Spectra detected issues while preparing administrative data. Review the items below to restore service health.</p>
  <table class="data-table">
    <thead>
      <tr>
        <th>Source</th>
        <th>Component</th>
        <th>Status</th>
        <th>Details</th>
      </tr>
    </thead>
    <tbody>
      {% for item in code_errors %}
      <tr>
        <td>{{ item.source or 'System' }}</td>
        <td>{{ item.name }}</td>
        <td>
          <span class="status status-offline">{{ item.status or 'Unavailable' }}</span>
        </td>
        <td>
          {{ item.message }}
          {% if item.description %}
          <br><small>{{ item.description }}</small>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</section>
{% endif %}
{% endblock %}

