{% extends 'base.html' %}

{% block content %}
<div class="employee-portal" data-employee-portal>
  <div class="employee-card">
    <header class="employee-card__header">
      <h1>Employee Portal</h1>
      <p class="employee-card__summary">Signed in as <strong>{{ username or 'Employee' }}</strong></p>
      <p class="employee-card__summary">Role: <strong>{{ user_role or 'Employee' }}</strong></p>
      <a class="employee-card__logout" href="{{ url_for('auth.logout') }}">Log out</a>
    </header>
    <div class="employee-card__body">
      <div class="employee-selection" data-area-selection>
        <label for="employee-area">Select your area</label>
        <select id="employee-area" data-area-select>
          <option value="" disabled selected>Choose an area</option>
          {% for area in areas %}
          <option value="{{ area }}">{{ area }}</option>
          {% endfor %}
        </select>
      </div>
      <section class="employee-area-panel" data-area-content hidden>
        <div class="employee-area-panel__header">
          <button type="button" class="employee-back" data-action="change-area">&larr; Select a different area</button>
          <h2 data-area-title></h2>
        </div>
        <div data-area-slot></div>
      </section>
    </div>
  </div>

  <template id="employee-area-message-template">
    <div class="employee-area-message">
      <p>This workflow is part of the prototype build and is not functional yet.</p>
    </div>
  </template>

  <template id="employee-aoi-template">
    <div class="employee-area-aoi">
      <p>Submit AOI inspection details directly to the quality database.</p>
      <div class="employee-subarea-picker" data-aoi-picker>
        <p>Select a data sheet to continue:</p>
        <div class="employee-button-group">
          <button type="button" data-sheet="SMT">SMT AOI Inspection Data Sheet</button>
          <button type="button" data-sheet="TH">TH AOI Inspection Data Sheet</button>
        </div>
      </div>
      <section class="employee-aoi-panel" data-sheet-panel hidden>
        <button type="button" class="employee-back" data-action="back-to-picker">&larr; Choose a different data sheet</button>
        <h3 class="inspection-sheet__heading" data-sheet-title></h3>
        <p class="inspection-sheet__subheading" data-sheet-subtitle hidden></p>
        <form class="inspection-sheet" data-sheet-form novalidate>
          <div class="inspection-progress" data-progress>
            <div class="inspection-progress__track">
              <div class="inspection-progress__bar" data-progress-bar></div>
            </div>
            <p class="inspection-progress__status">
              Step <span data-progress-current>1</span> of <span data-progress-total>1</span>
            </p>
          </div>

          <div class="inspection-steps" data-step-list>
            <fieldset class="inspection-sheet__section inspection-sheet__section--info" data-step-group>
              <legend>Inspection Information</legend>
              <div class="inspection-step" data-step data-step-name="date">
                <label class="inspection-field">
                  <span class="inspection-field__label">Date</span>
                  <input type="date" name="date" required>
                </label>
              </div>
              <div class="inspection-step" data-step data-step-name="shift">
                <label class="inspection-field">
                  <span class="inspection-field__label">Shift</span>
                  <select name="shift" required>
                    <option value="" disabled selected>Select shift</option>
                    <option value="1st">1st</option>
                    <option value="2nd">2nd</option>
                    <option value="3rd">3rd</option>
                    <option value="Weekend">Weekend</option>
                    <option value="Other">Other</option>
                  </select>
                </label>
              </div>
              <div class="inspection-step" data-step data-step-name="operator">
                <label class="inspection-field">
                  <span class="inspection-field__label">Operator</span>
                  <input type="text" name="operator" required>
                </label>
              </div>
            </fieldset>

            <fieldset class="inspection-sheet__section" data-step-group>
              <legend>Product Details</legend>
              <div class="inspection-step" data-step data-step-name="customer">
                <label class="inspection-field">
                  <span class="inspection-field__label">Customer</span>
                  <input type="text" name="customer" required>
                </label>
              </div>
              <div class="inspection-step" data-step data-step-name="program">
                <label class="inspection-field">
                  <span class="inspection-field__label">Program</span>
                  <input type="text" name="program" required>
                </label>
              </div>
              <div class="inspection-step" data-step data-step-name="assembly">
                <label class="inspection-field">
                  <span class="inspection-field__label">Assembly</span>
                  <input type="text" name="assembly" required>
                </label>
              </div>
              <div class="inspection-step" data-step data-step-name="revision" data-step-optional>
                <label class="inspection-field">
                  <span class="inspection-field__label">Revision</span>
                  <input type="text" name="rev" placeholder="Optional">
                </label>
              </div>
              <div class="inspection-step" data-step data-step-name="job-number">
                <label class="inspection-field">
                  <span class="inspection-field__label">Job Number</span>
                  <input type="text" name="job_number" required>
                </label>
              </div>
            </fieldset>

            <fieldset class="inspection-sheet__section inspection-sheet__section--results" data-step-group>
              <legend>Inspection Results</legend>
              <div class="inspection-step" data-step data-step-name="quantity-inspected">
                <label class="inspection-field">
                  <span class="inspection-field__label">Quantity Inspected</span>
                  <input type="number" name="quantity_inspected" min="0" step="1" required>
                </label>
              </div>
              <div class="inspection-step" data-step data-step-name="quantity-rejected">
                <label class="inspection-field">
                  <span class="inspection-field__label">Quantity Rejected</span>
                  <input type="number" name="quantity_rejected" min="0" step="1" required>
                </label>
              </div>
              <div class="inspection-step" data-step data-step-name="rejection">
                <input type="hidden" name="rejection_details" data-rejection-json>
                <section class="inspection-rejection" data-rejection-details hidden aria-label="Reason for rejection details">
                  <header class="inspection-rejection__header">
                    <h4>Rejection Details</h4>
                    <p>List each rejected assembly, describe the reason, and include the rejected quantity.</p>
                  </header>
                  <div class="inspection-rejection__controls">
                    <button type="button" class="inspection-rejection__add" data-action="add-rejection-row">Add rejection reason</button>
                  </div>
                  <div class="inspection-rejection__table">
                    <table>
                      <caption class="sr-only">Rejected assemblies and associated reasons</caption>
                      <thead>
                        <tr>
                          <th scope="col">Reference Designator</th>
                          <th scope="col">Rejection Reason</th>
                          <th scope="col">Quantity</th>
                          <th scope="col"><span class="sr-only">Actions</span></th>
                        </tr>
                      </thead>
                      <tbody data-rejection-rows>
                        <tr data-rejection-empty>
                          <td colspan="4">Add rows to capture each rejected assembly.</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </section>
                <template data-rejection-row-template>
                  <tr data-rejection-row>
                    <td data-label="Reference Designator">
                      <input type="text" data-rejection-ref placeholder="e.g. R15" autocomplete="off">
                    </td>
                    <td data-label="Rejection Reason">
                      <input type="text" data-rejection-reason placeholder="e.g. Bent lead" autocomplete="off">
                    </td>
                    <td data-label="Quantity">
                      <input type="number" data-rejection-quantity min="1" step="1" placeholder="0">
                    </td>
                    <td data-label="Actions">
                      <button type="button" class="inspection-rejection__remove" data-action="remove-rejection-row">Remove</button>
                    </td>
                  </tr>
                </template>
              </div>
            </fieldset>

            <fieldset class="inspection-sheet__section inspection-sheet__section--notes" data-step-group>
              <legend>Notes</legend>
              <div class="inspection-step" data-step data-step-name="notes" data-step-optional>
                <label class="inspection-field inspection-field--full">
                  <span class="inspection-field__label">Additional Information</span>
                  <textarea name="notes" rows="3" placeholder="Optional notes"></textarea>
                </label>
              </div>
            </fieldset>
          </div>

          <section class="inspection-sheet__signoff" aria-label="Inspection sign-off" data-step-finish hidden>
            <div class="inspection-signature">
              <span class="inspection-signature__label">Operator Signature</span>
              <span class="inspection-signature__line" aria-hidden="true"></span>
              <span class="inspection-signature__hint">Sign on file</span>
            </div>
            <div class="inspection-signature">
              <span class="inspection-signature__label">Quality Approval</span>
              <span class="inspection-signature__line" aria-hidden="true"></span>
              <span class="inspection-signature__hint">QA review</span>
            </div>
          </section>

          <div class="inspection-sheet__actions" data-step-finish hidden>
            <button type="submit" class="inspection-submit">Submit inspection</button>
          </div>
          <div class="inspection-sheet__feedback employee-feedback" role="alert" aria-live="polite"></div>
        </form>
      </section>
    </div>
  </template>
</div>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script src="{{ url_for('static', filename='js/employee.js') }}" defer></script>
{% endblock %}
